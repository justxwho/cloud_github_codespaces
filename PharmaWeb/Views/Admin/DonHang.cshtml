@model IEnumerable<PharmaWeb.Models.DonHang>

@{
    ViewData["Title"] = "Quản lý Đơn hàng";
}

<div class="container mt-4">
    <h2>Danh sách Đơn Hàng</h2>
    <table class="table table-hover">
        <thead>
            <tr>
                <th>Mã ĐH</th>
                <th>Khách hàng</th>
                <th>Ngày đặt</th>
                <th>Tổng tiền</th>
                <th>Trạng thái</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>#@item.MaDh</td>
                    <td>@(item.MaKhNavigation?.HoTen ?? "Khách lẻ")</td>
                    <td>@item.NgayDat</td>
                    <td class="fw-bold">@item.TongTien?.ToString("N0")</td>
                    <td>
                        <select onchange="updateStatus(@item.MaDh, this.value)" class="form-select form-select-sm">
                            <option value="Chờ xác nhận" selected="@(item.TrangThai == "Chờ xác nhận")">Chờ xác nhận</option>
                            <option value="Đang giao" selected="@(item.TrangThai == "Đang giao")">Đang giao</option>
                            <option value="Hoàn tất" selected="@(item.TrangThai == "Hoàn tất")">Hoàn tất</option>
                            <option value="Đã hủy" selected="@(item.TrangThai == "Đã hủy")">Đã hủy</option>
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info">Xem CT</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script>
        function updateStatus(id, newStatus) {
            $.post('/Admin/CapNhatTrangThai', { id: id, trangThai: newStatus }, function(res) {
                if(res.success) {
                    alert('Cập nhật thành công!');
                } else {
                    alert('Lỗi cập nhật');
                }
            });
        }
    </script>
}